<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexPlayy | Admin Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <nav id="navbar" class="scrolled">
        <div class="logo">NexPlayy Admin</div>
        <div class="nav-links">
            <a href="index.html">View Site</a>
            <a href="#" onclick="logout()">Logout</a>
        </div>
    </nav>

    <!-- Login Screen -->
    <div id="loginGate" class="admin-login">
        <div class="glass" style="padding: 40px; width: 100%; max-width: 400px;">
            <h2 style="margin-bottom: 20px;">Admin Access</h2>
            <div class="form-group">
                <input type="password" id="adminPassword" placeholder="Enter Password">
            </div>
            <button class="btn btn-primary" style="width: 100%;" onclick="checkLogin()">Login</button>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="admin-container" style="display: none;">
        <div class="admin-header">
            <h2>Game Inventory</h2>
            <button class="btn btn-primary btn-small" onclick="showAddModal()">+ Add New Game</button>
        </div>

        <!-- Hero Settings -->
        <div class="admin-card">
            <h3>Hero Section Controls</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                <div class="form-group">
                    <label>Main Headline</label>
                    <input type="text" id="heroTitle" onchange="updateHeroData()">
                </div>
                <div class="form-group">
                    <label>Sub Headline</label>
                    <input type="text" id="heroSub" onchange="updateHeroData()">
                </div>
            </div>
        </div>

        <!-- Games Table -->
        <div class="admin-card">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Image</th>
                        <th>Game Name</th>
                        <th>Price</th>
                        <th>Range</th>
                        <th>Badge</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="adminGamesList">
                    <!-- Dynamic -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal for Adding/Editing -->
    <div id="gameModal" class="admin-login"
        style="display: none; position: fixed; top: 0; left: 0; background: rgba(0,0,0,0.9); z-index: 3000;">
        <div class="glass" style="padding: 30px; width: 100%; max-width: 500px; text-align: left;">
            <h3 id="modalTitle">Add New Game</h3>
            <div class="form-group">
                <label>Game Name</label>
                <input type="text" id="mName">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label>Price (â‚¹)</label>
                    <input type="number" id="mPrice">
                </div>
                <div class="form-group">
                    <label>Old Price (â‚¹)</label>
                    <input type="number" id="mOldPrice">
                </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label>Range (149 or 199)</label>
                    <select id="mRange">
                        <option value="149">149</option>
                        <option value="199">199</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Badge (e.g. NEW, OFFER)</label>
                    <input type="text" id="mBadge">
                </div>
            </div>
            <div class="form-group">
                <label>Image URL (Google Drive links are fixed automatically)</label>
                <input type="text" id="mImage">
            </div>
            <div class="form-group">
                <label>Platform (e.g. PC / PS5)</label>
                <input type="text" id="mPlatform">
            </div>
            <div class="action-btns">
                <button class="btn btn-primary" onclick="saveGame()">Save Game</button>
                <button class="btn btn-outline" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Export Button -->
    <div class="export-section">
        <button class="btn btn-outline" onclick="exportData()" title="Click this to get the code for main.js">ðŸ’¾ Export
            Data for Live Site</button>
    </div>

    <script>
        // Use standard initial data if local is empty
        let localGames = JSON.parse(localStorage.getItem('nexplayy_games')) || [];
        let heroData = JSON.parse(localStorage.getItem('nexplayy_hero')) || { title: "LEVEL UP YOUR GAMING LIBRARY", sub: "NexPlayy Store provides 100% genuine games for PC & Console." };
        let currentEditIndex = -1;

        function checkLogin() {
            if (document.getElementById('adminPassword').value === 'nexplayy_admin') {
                document.getElementById('loginGate').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                initDashboard();
            } else {
                alert('Wrong Password!');
            }
        }

        function initDashboard() {
            document.getElementById('heroTitle').value = heroData.title;
            document.getElementById('heroSub').value = heroData.sub;
            renderAdminGames();
        }

        function updateHeroData() {
            heroData.title = document.getElementById('heroTitle').value;
            heroData.sub = document.getElementById('heroSub').value;
            localStorage.setItem('nexplayy_hero', JSON.stringify(heroData));
        }

        function renderAdminGames() {
            const list = document.getElementById('adminGamesList');
            list.innerHTML = '';

            // If local is empty, we'll try to fetch from current main.js data or just start fresh
            if (localGames.length === 0) {
                list.innerHTML = '<tr><td colspan="6" style="text-align:center;">No games added yet. Add your first game!</td></tr>';
                return;
            }

            localGames.forEach((game, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><img src="${game.image}" style="width: 40px; height: 50px; object-fit: cover; border-radius: 4px;"></td>
                    <td>${game.name}</td>
                    <td>â‚¹${game.price}</td>
                    <td><span class="status-badge status-${game.range}">${game.range}</span></td>
                    <td>${game.badge || '-'}</td>
                    <td>
                        <div class="action-btns">
                            <button class="btn btn-outline btn-small" onclick="editGame(${index})"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-outline btn-small" style="border-color: #ff4444; color: #ff4444;" onclick="deleteGame(${index})"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                `;
                list.appendChild(tr);
            });
        }

        function showAddModal() {
            currentEditIndex = -1;
            document.getElementById('modalTitle').innerText = 'Add New Game';
            document.getElementById('mName').value = '';
            document.getElementById('mPrice').value = '';
            document.getElementById('mOldPrice').value = '';
            document.getElementById('mRange').value = '149';
            document.getElementById('mBadge').value = '';
            document.getElementById('mImage').value = '';
            document.getElementById('mPlatform').value = 'PC / PS / Xbox';
            document.getElementById('gameModal').style.display = 'flex';
        }

        function editGame(index) {
            currentEditIndex = index;
            const g = localGames[index];
            document.getElementById('modalTitle').innerText = 'Edit Game';
            document.getElementById('mName').value = g.name;
            document.getElementById('mPrice').value = g.price;
            document.getElementById('mOldPrice').value = g.oldPrice || '';
            document.getElementById('mRange').value = g.range;
            document.getElementById('mBadge').value = g.badge || '';
            document.getElementById('mImage').value = g.image;
            document.getElementById('mPlatform').value = g.platform;
            document.getElementById('gameModal').style.display = 'flex';
        }

        function saveGame() {
            const game = {
                name: document.getElementById('mName').value,
                price: parseInt(document.getElementById('mPrice').value),
                oldPrice: parseInt(document.getElementById('mOldPrice').value) || null,
                range: document.getElementById('mRange').value,
                badge: document.getElementById('mBadge').value,
                image: document.getElementById('mImage').value,
                platform: document.getElementById('mPlatform').value
            };

            if (currentEditIndex > -1) {
                localGames[currentEditIndex] = game;
            } else {
                localGames.push(game);
            }

            localStorage.setItem('nexplayy_games', JSON.stringify(localGames));
            closeModal();
            renderAdminGames();
        }

        function deleteGame(index) {
            if (confirm('Delete this game?')) {
                localGames.splice(index, 1);
                localStorage.setItem('nexplayy_games', JSON.stringify(localGames));
                renderAdminGames();
            }
        }

        function closeModal() {
            document.getElementById('gameModal').style.display = 'none';
        }

        function exportData() {
            const data = {
                hero: heroData,
                games: localGames
            };
            const json = JSON.stringify(data, null, 2);
            // This copies it to clipboard and also shows it
            const textarea = document.createElement('textarea');
            textarea.value = `// Copy this into your main.js to make changes permanent for everyone!\nconst gamesData = ${JSON.stringify(localGames, null, 2)};\nconst heroData = ${JSON.stringify(heroData, null, 2)};`;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            alert('Full Website Data copied to clipboard! You can now paste this into your main.js file to make it permanent for all visitors.');
        }

        function logout() {
            location.reload();
        }
    </script>
</body>

</html>